@{
    ViewData["Title"] = "Edit Event";
}

<div class="report-container">
    <div class="page-title">
        <h1 class="glowing-text">Edit Event</h1>
        <p class="subtitle">Modify event details</p>
    </div>

    <div class="neon-card">
        <form method="post" action="/Admin/EditEvent">
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>

            <input type="hidden" id="Id" name="Id" />
            <input type="hidden" id="CreatedDate" name="CreatedDate" />
            <input type="hidden" id="ViewCount" name="ViewCount" />

            <div class="mb-3">
                <label for="Title" class="form-label">Title</label>
                <input id="Title" name="Title" class="form-control neon-input" />
            </div>

            <div class="mb-3">
                <label for="Description" class="form-label">Description</label>
                <textarea id="Description" name="Description" class="form-control neon-input" rows="4"></textarea>
            </div>

            <div class="mb-3">
                <label for="Category" class="form-label">Category</label>
                <select id="Category" name="Category" class="form-select neon-select" required>
                    <option value="">Select a category</option>
                    @if (ViewBag.Categories != null)
                    {
                        @foreach (string category in ViewBag.Categories)
                        {
                            <option value="@category" selected="@(Model.Category == category)">@category</option>
                        }
                    }
                </select>
            </div>

            <div class="mb-3">
                <label for="EventDate" class="form-label">Event Date</label>
                <input id="EventDate" name="EventDate" type="datetime-local" class="form-control neon-input" min="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" />
            </div>

            <div class="mb-3">
                <label for="Location" class="form-label">Location</label>
                <input id="Location" name="Location" class="form-control neon-input" />
            </div>

            <div class="mb-3">
                <label for="ImagePath" class="form-label">Image Path (optional)</label>
                <input id="ImagePath" name="ImagePath" class="form-control neon-input" placeholder="Leave empty for default image" />
            </div>

            <div class="mb-3">
                <label for="tagsInput" class="form-label">Tags</label>
                <select id="tagsInput" name="tagsInput" class="form-select neon-select" multiple required>
                    @if (ViewBag.Tags != null)
                    {
                        @foreach (string tag in ViewBag.Tags)
                        {
                            <option value="@tag">@tag</option>
                        }
                    }
                </select>
                <small class="form-text text-muted">Hold Ctrl (or Cmd on Mac) to select multiple tags</small>
            </div>

            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary neon-button">Save Changes</button>
                <a asp-action="Dashboard" class="btn btn-outline-secondary neon-button">Cancel</a>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Pre-select existing tags
            const tagsInput = document.getElementById('tagsInput');
            const existingTags = '@ViewBag.TagsInput'.split(', ').map(t => t.trim()).filter(t => t);

            if (tagsInput && existingTags.length > 0) {
                for (let option of tagsInput.options) {
                    if (existingTags.includes(option.value)) {
                        option.selected = true;
                    }
                }
            }
        });
    </script>
}